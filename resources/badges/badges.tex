\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{csvsimple,ifthen,tikz,graphicx,xcolor}
\usepackage{xstring}
\usetikzlibrary{calc}
\newif\ifDraftMode\DraftModefalse
\newif\ifMirroredPage\MirroredPagefalse

\renewcommand{\sfdefault}{lmss}

% You may change the following two values (within reason).  Everything
% else will be recomputed automatically.
\newcommand{\BadgeWidth}{10.5cm}
\newcommand{\BadgeHeight}{7cm}

% Distance between badges.  You probably do not need to change this.
\newcommand{\BadgeSepX}{0cm}
\newcommand{\BadgeSepY}{0.3cm}

% The amount of overprinting (irrelevant for draft mode)
\newcommand{\Fudge}{1.5mm}

% Shortening of the crop marks (may be negative)
\newcommand{\CropMarksSep}{0.5mm}

% There are 8 badges per page, so we can compute the margins.
\pgfmathsetlengthmacro{\BadgeMarginTop}{0}
\pgfmathsetlengthmacro{\BadgeMarginLeft}{\paperwidth - 2 * \BadgeWidth - \BadgeSepX}

% No overprinting in draft mode.
\ifDraftMode
  \renewcommand{\Fudge}{0}
\fi

\newcommand*{\SingleBadge}[1]{
  \pgfmathsetlengthmacro{\xshiftleft}{\BadgeWidth / 2 + \BadgeMarginLeft}
  \pgfmathsetlengthmacro{\xshiftright}{\BadgeWidth + \BadgeSepX + \BadgeWidth / 2 + \BadgeMarginLeft}
  \pgfmathsetlengthmacro{\yshift}{#1 * (\BadgeHeight + \BadgeSepY) + \BadgeHeight / 2 + \BadgeMarginTop}

  % LEFT PART = RECTO
  % -----------------
  \node [xshift=\xshiftleft,yshift=-\yshift] at (current page.north west) {
  \begin{tikzpicture}
    \draw [use as bounding box,draw=none] (0,0) rectangle (\BadgeWidth,\BadgeHeight);

    % Logo
    \node[anchor=north] at (\BadgeWidth / 2,\BadgeHeight) {
        \includegraphics[width=10cm]{../../resources/badges/caef-bandeau.jpg}
    };

    % Name and origin
    \node [anchor=south] at (\BadgeWidth / 2, 2.0) {\textbf{\LARGE{\firstname~\lastname}}};
    % \node [anchor=south] at (\BadgeWidth / 2, 1.3) {\large{\church}};
    \node [anchor=south] at (\BadgeWidth / 2, 0.7) {\large{\postalcode~- \city}};
  \end{tikzpicture}
  };


  % RIGHT PART = VERSO
  % ------------------
  \node [xshift=\xshiftright,yshift=-\yshift] at (current page.north west) {
  \begin{tikzpicture}
    \draw [use as bounding box,draw=none] (0,0) rectangle (\BadgeWidth,\BadgeHeight);

    % ticket
    \node[anchor=west] at (0.7cm,\BadgeHeight - 1cm) {\textbf{\ticket}};

    % accomodation
    \ifthenelse{ \equal{\accomodation}{} }{ }{
      \node[anchor=west, text width=\BadgeWidth*0.7, align=left] at (0.7cm,\BadgeHeight - 2.2cm) { \StrDel{\accomodation}{ par personne} };
    }

    % room
    \ifthenelse{ \equal{\room}{} }{ }{
      \node[anchor=west, text width=\BadgeWidth*0.7, align=left] at (0.7cm,\BadgeHeight - 3.3cm) {Chambre : \textbf{\room}};
    }

    % meals
    \draw (0.8cm, \BadgeHeight - 6.2cm)
      rectangle ++(2cm, 1.8cm) node[text width=1cm,pos=0.5,align=center] { \ifthenelse{ \equal{\mealA}{} \and \equal{\mealAB}{} }{  }{ \textbf{\huge{VS}} } }
      rectangle ++(2cm, -1.8cm) node[text width=1cm,pos=0.5,align=center] { \ifthenelse{ \equal{\mealB}{} \and \equal{\mealBB}{} }{  }{ \textbf{\huge{SM}} } }
      rectangle ++(2cm, 1.8cm) node[text width=1cm,pos=0.5,align=center] { \ifthenelse{ \equal{\mealC}{} \and \equal{\mealCB}{} }{  }{ \textbf{\huge{SS}} } }
      rectangle ++(2cm, -1.8cm) node[text width=1cm,pos=0.5,align=center] { \ifthenelse{ \equal{\mealD}{} \and \equal{\mealDB}{} }{  }{ \textbf{\huge{DM}} } };

    %% A frame
    % Draw a frame around the badge if in draft mode.
    \ifDraftMode
      \draw (0,0) rectangle (\BadgeWidth,\BadgeHeight);
    \fi
  \end{tikzpicture}
  };
}

\newcommand{\BadgesPerPage}{8}

\pagestyle{empty}
\begin{document}
  \sffamily
  \def\i{0}
  % The number of badges already printed on this page plus 1.
  \def\onthispagesofar{1}
  \csvreader{attendees.csv}{%
    3=\firstname,
    4=\lastname,
    9=\postalcode,
    10=\city,
    16=\ticket,
    12=\room,
    17=\accomodation,
    18=\mealA, % ven soir
    19=\mealB, % sam mid
    20=\mealC, % sam soir
    21=\mealD, % dim mid
    23=\mealAB, % ven soir < 10 ans
    24=\mealBB, % sam mid < 10 ans
    25=\mealCB, % sam soir < 10 ans
    22=\mealDB}% dim midi < 10 ans
  {
    \pgfmathtruncatemacro{\j}{mod(\i, 4)}

    \ifnum\j=0\ifnum\i=0\else
      \newpage
    \fi\fi

    \ifMirroredPage
      \pgfmathtruncatemacro{\j}{\j - mod(\i, 2) + mod(\i + 1, 2)}
    \fi

    \begin{tikzpicture}[remember picture,overlay]
      \SingleBadge{\j}
    \end{tikzpicture}

    \pgfmathtruncatemacro{\i}{\i+1}
    \pgfmathtruncatemacro{\onthispagesofar}{mod(\onthispagesofar, \BadgesPerPage) + 1}
  }%
\end{document}
